<!DOCTYPE html>
<html>
<head>
  <title>My Orders - High Street</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<header class="site-header">
  <div class="header-left">
    <h1 class="logo">
      <a href="index.html">HIGH&nbsp;STREET</a>
    </h1>
  </div>

  <nav class="main-nav">
    <a href="index.html">Home</a>
    <a href="men.html">Men</a>
    <a href="women.html">Women</a>
  </nav>
</header>

<hr>

<h2 class="section-title">My Orders</h2>

<div class="form-container">
  <div class="login-form" id="ordersBox">
    <p>Loading your orders...</p>
  </div>
</div>

<hr>

<p class="copyright">
  ©️ 2025 High Street. All Rights Reserved.
</p>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

<script>
/* ============ SUPABASE CONFIG ============ */
const SUPABASE_URL = "https://lnjkpbbjzjrpuwhmbqkd.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuamtwYnBpempycHVod21icWtkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTQwNTMsImV4cCI6MjA4MzE5MDA1M30.VSPdTEwoSs4DEreHGwKSHjnDE9qGD-Lp9iLM6V3zMlw";

const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

const ordersBox = document.getElementById("ordersBox");

/* ============ LOAD ORDERS ============ */
async function loadOrders() {

  const { data, error } = await supabaseClient.auth.getUser();

  if (error || !data.user) {
    ordersBox.innerHTML = `
      <p style="color:red; text-align:center;">
        Please login to view orders
      </p>
      <p style="text-align:center;">
        <a href="login.html">Login</a>
      </p>
    `;
    return;
  }

  const userId = data.user.id;

  const { data: orders, error: fetchError } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("user_id", userId)
    .order("created_at", { ascending: false });

  if (fetchError) {
    ordersBox.innerHTML = "Failed to load orders";
    console.error(fetchError);
    return;
  }

  if (orders.length === 0) {
    ordersBox.innerHTML = "<p>No orders found.</p>";
    return;
  }

  let html = "";

  orders.forEach(order => {
    html += `
      <div style="border-bottom:1px solid #ddd; padding-bottom:15px; margin-bottom:15px;">
        <p><strong>Order ID:</strong> ${order.order_id}</p>
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Total:</strong> ₹${order.total_amount}</p>
        <p><strong>Payment:</strong> ${order.payment_method}</p>
      </div>
    `;
  });

  ordersBox.innerHTML = html;
}

loadOrders();
</script>
</body>
</html>

