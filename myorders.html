<!DOCTYPE html>
<html>
<head>
  <title>My Orders - High Street</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<h2 class="section-title">My Orders</h2>

<div class="form-container">
  <div class="login-form" id="ordersBox">
    Loading orders...
  </div>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script src="supabase.js"></script>
<script src="auth.js"></script>

<script>
async function loadOrders() {
  const box = document.getElementById("ordersBox");

  const { data: auth } = await supabaseClient.auth.getUser();
  if (!auth.user) {
    box.innerHTML = "Please login to view orders";
    return;
  }

  const userId = auth.user.id;

  const { data: orders, error } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("user_id", userId)
    .order("created_at", { ascending: false });

  if (error) {
    box.innerHTML = error.message;
    return;
  }

  if (!orders || orders.length === 0) {
    box.innerHTML = "No orders found";
    return;
  }

  let html = "";

  orders.forEach(order => {
    html += `
      <div style="background:#f8f8f8;padding:15px;border-radius:8px;margin-bottom:20px;">
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Total:</strong> ₹${order.total_amount}</p>
        <p><strong>Payment:</strong> ${order.payment_method}</p>

        <hr>

        <h4>Products</h4>
    `;

    /* ✅ SHOW PRODUCTS WITH IMAGE */
    order.items.forEach(item => {
      html += `
        <div style="display:flex;gap:15px;align-items:center;margin-bottom:10px;">
          <img src="${item.image}" style="width:80px;border-radius:6px;">
          <div>
            <p><strong>${item.name}</strong></p>
            <p>₹${item.price} × ${item.qty}</p>
          </div>
        </div>
      `;
    });

    html += </div>;
  });

  box.innerHTML = html;
}

loadOrders();
</script>

</body>
</html>
