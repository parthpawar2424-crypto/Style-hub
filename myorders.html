<!DOCTYPE html>
<html>
<head>
  <title>My Orders - Debug</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>My Orders â€” Debug Mode</h2>
  <div id="debugBox" style="max-width:900px;margin:20px auto;font-family:Arial,Helvetica,sans-serif"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

<script>
/* ===== SUPABASE CONFIG ===== */
const SUPABASE_URL = "https://lnjkpbbjzjrpuwhmbqkd.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuamtwYnBpempycHVod21icWtkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTQwNTMsImV4cCI6MjA4MzE5MDA1M30.VSPdTEwoSs4DEreHGwKSHjnDE9qGD-Lp9iLM6V3zMlw";

const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

const ordersBox = document.getElementById("ordersBox");

/* ===== LOAD ORDERS SAFELY ===== */
async function loadOrders() {

  // âœ… STEP 1: Get session (IMPORTANT)
  const { data: sessionData } = await supabaseClient.auth.getSession();

  if (!sessionData.session) {
    ordersBox.innerHTML = `
      <p style="color:red; text-align:center;">
        Please login to view your orders
      </p>
      <p style="text-align:center;">
        <a href="login.html">Login</a>
      </p>
    `;
    return;
  }

  // âœ… STEP 2: Get user from session
  const user = sessionData.session.user;

  // âœ… STEP 3: Fetch orders for this user
  const { data: orders, error } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("user_id", user.id)
    .order("created_at", { ascending: false });

  if (error) {
    ordersBox.innerHTML = "Failed to load orders";
    console.error(error);
    return;
  }

  if (orders.length === 0) {
    ordersBox.innerHTML = "<p>No orders found.</p>";
    return;
  }

  let html = "";

  orders.forEach(order => {
    html += `
      <div style="border-bottom:1px solid #ddd; margin-bottom:15px; padding-bottom:10px;">
        <p><strong>Order ID:</strong> ${order.order_id}</p>
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Total:</strong> â‚¹${order.total_amount}</p>
        <p><strong>Payment:</strong> ${order.payment_method}</p>
      </div>
    `;
  });

  ordersBox.innerHTML = html;
}

// ðŸ”¥ RUN AFTER PAGE LOAD
loadOrders();
</script>
</body>
</html>


