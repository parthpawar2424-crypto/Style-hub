<!DOCTYPE html>
<html>
<head>
  <title>My Orders - High Street</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<h2 class="section-title">My Orders</h2>

<div class="form-container">
  <div class="login-form" id="ordersBox">
    Loading orders...
  </div>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script src="supabase.js"></script>
<script src="auth.js"></script>

<script>
async function loadOrders() {
  const box = document.getElementById("ordersBox");

  const { data: auth } = await supabaseClient.auth.getUser();
  if (!auth.user) {
    box.innerHTML = "Please login to view orders";
    return;
  }

  const { data: orders, error } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("user_id", auth.user.id)
    .order("created_at", { ascending: false });

  if (error) {
    box.innerHTML = error.message;
    return;
  }

  if (orders.length === 0) {
    box.innerHTML = "No orders found";
    return;
  }

  let html = "";
  orders.forEach(o => {
    html += `
      <div class="order-card">
        <p><strong>Status:</strong> ${o.status}</p>
        <p><strong>Total:</strong> â‚¹${o.total_amount}</p>
        <p><strong>Payment:</strong> ${o.payment_method}</p>
        <button onclick="viewOrder('${o.id}')">View Details</button>
      </div>
    `;
  });

  box.innerHTML = html;
}

function viewOrder(orderId) {
  window.location.href = order-details.html?id=${orderId};
}

loadOrders();
</script>

</body>
</html>


