<!DOCTYPE html>
<html>
<head>
  <title>My Orders - Debug</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>My Orders — Debug Mode</h2>
  <div id="debugBox" style="max-width:900px;margin:20px auto;font-family:Arial,Helvetica,sans-serif"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script>
// ====== CONFIG ======
const SUPABASE_URL = "https://lnjkpbbjzjrpuwhmbqkd.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuamtwYnBpempycHVod21icWtkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTQwNTMsImV4cCI6MjA4MzE5MDA1M30.VSPdTEwoSs4DEreHGwKSHjnDE9qGD-Lp9iLM6V3zMlw";

const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const debugBox = document.getElementById('debugBox');

function log(msg, obj){
  console.log(msg, obj);
  const p = document.createElement('pre');
  p.style.background='#f7f7f7'; p.style.padding='8px'; p.style.border='1px solid #eee';
  p.textContent = typeof obj === 'undefined' ? msg : ${msg}\n${JSON.stringify(obj,null,2)};
  debugBox.appendChild(p);
}

async function runDebug() {
  log("START DEBUG");

  // 1) Supabase client present?
  log("supabaseClient defined?", !!supabaseClient);

  // 2) Show session / user
  try {
    const resUser = await supabaseClient.auth.getUser();
    log("auth.getUser() ->", resUser);
  } catch(e){
    log("auth.getUser() threw ->", e.message || e);
  }

  // 3) Try fetching last 10 orders (no filter)
  try {
    const resAll = await supabaseClient
      .from('orders')
      .select('id,order_id,user_id,total_amount,status,created_at')
      .order('created_at',{ascending:false})
      .limit(10);
    log("fetch last 10 orders (no filter) ->", resAll);
  } catch(e){
    log("fetch all threw ->", e.message || e);
  }

  // 4) If user present, fetch orders for user
  try {
    const got = await supabaseClient.auth.getUser();
    const user = got?.data?.user;
    log("current user object ->", user);

    if (user && user.id) {
      const resUserOrders = await supabaseClient
        .from('orders')
        .select('*')
        .eq('user_id', user.id)
        .order('created_at',{ascending:false});
      log("orders for this user ->", resUserOrders);
    } else {
      log("No logged-in user found — please login first.");
    }
  } catch(e){
    log("user-orders fetch threw ->", e.message || e);
  }

  // 5) Show SQL check to run in Supabase console
  log("SQL to inspect orders (run in Supabase SQL editor):", 
select id, order_id, user_id, created_at from public.orders order by created_at desc limit 20;);
}

runDebug();
</script>
</body>
</html>

