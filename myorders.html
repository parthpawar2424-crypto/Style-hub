<!DOCTYPE html>
<html>
<head>
  <title>My Orders - High Street</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<h2 style="text-align:center">My Orders</h2>

<div class="form-container">
  <div class="login-form" id="ordersBox">
    Loading orders...
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

<script>
/* ===== SUPABASE CONFIG ===== */
const SUPABASE_URL = "https://lnjkpbbjzjrpuwhmbqkd.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuamtwYnBpempycHVod21icWtkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTQwNTMsImV4cCI6MjA4MzE5MDA1M30.VSPdTEwoSs4DEreHGwKSHjnDE9qGD-Lp9iLM6V3zMlw";

/* âœ… CORRECT CLIENT INIT (THIS IS THE FIX) */
const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY,
  {
    auth: {
      persistSession: true,
      autoRefreshToken: true,
      storage: window.localStorage
    }
  }
);

const ordersBox = document.getElementById("ordersBox");

async function loadOrders() {

  /* âœ… WAIT FOR SESSION */
  const {
    data: { session }
  } = await supabaseClient.auth.getSession();

  if (!session) {
    ordersBox.innerHTML = `
      <p style="color:red; text-align:center;">
        Please login to view your orders
      </p>
      <p style="text-align:center;">
        <a href="login.html">Login</a>
      </p>
    `;
    return;
  }

  const userId = session.user.id;

  const { data: orders, error } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("user_id", userId)
    .order("created_at", { ascending: false });

  if (error) {
    ordersBox.innerHTML = "Error loading orders";
    return;
  }

  if (orders.length === 0) {
    ordersBox.innerHTML = "No orders found.";
    return;
  }

  let html = "";

  orders.forEach(o => {
    html += `
      <div style="border-bottom:1px solid #ccc; margin-bottom:12px;">
        <p><strong>Order ID:</strong> ${o.order_id}</p>
        <p><strong>Status:</strong> ${o.status}</p>
        <p><strong>Total:</strong> â‚¹${o.total_amount}</p>
        <p><strong>Payment:</strong> ${o.payment_method}</p>
      </div>
    `;
  });

  ordersBox.innerHTML = html;
}

/* ðŸ”¥ LOAD AFTER PAGE READY */
window.addEventListener("load", loadOrders);
</script>

</body>
</html>
